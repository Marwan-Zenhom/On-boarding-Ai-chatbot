{"ast":null,"code":"import _objectSpread from\"/workspace/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef,useCallback,useMemo}from'react';import{Plus,ArrowUp,User,Bot,Sun,Moon,Search,Mic,MicOff,Archive,Sidebar,X,FileText,Paperclip,Square}from'lucide-react';import apiService from'./services/apiService';import{useLocalStorage}from'./hooks/useLocalStorage';import{SUPPORTED_LANGUAGES}from'./constants/languages';import FileUpload from'./components/FileUpload';import ArchivedConversationsModal from'./components/ArchivedConversationsModal';import ConversationItem from'./components/ConversationItem';import Message from'./components/Message';import{SkeletonLoader,Toast}from'./components/UtilityComponents';// --- Main App Component ---\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function App(){var _pastConversations$fi,_SUPPORTED_LANGUAGES$,_SUPPORTED_LANGUAGES$2,_SUPPORTED_LANGUAGES$3;// --- State Management ---\nconst[pastConversations,setPastConversations]=useState([]);const[conversationsLoading,setConversationsLoading]=useState(true);const[messages,setMessages]=useState([]);const[input,setInput]=useState('');const[isLoading,setIsLoading]=useState(false);const[currentConversationId,setCurrentConversationId]=useState(null);const[isSidebarCollapsed,setIsSidebarCollapsed]=useState(false);const[isSidebarOpen,setIsSidebarOpen]=useState(false);const[isSidebarHidden,setIsSidebarHidden]=useState(true);const[isMobile,setIsMobile]=useState(window.innerWidth<=768);const[isDarkMode,setIsDarkMode]=useLocalStorage('darkMode',true);const[searchQuery,setSearchQuery]=useState('');const[isSearchFocused,setIsSearchFocused]=useState(false);const[isRecording,setIsRecording]=useState(false);const[recognition,setRecognition]=useState(null);const[multiRecognitions,setMultiRecognitions]=useState([]);const[speechLanguage,setSpeechLanguage]=useState(()=>{// Try to match browser language with supported languages\nconst browserLang=navigator.language||'en-US';const supportedCodes=['en-US','en-GB','de-DE','fr-FR','es-ES','it-IT','pt-PT','nl-NL','ru-RU','ja-JP','ko-KR','zh-CN','ar-SA'];return supportedCodes.includes(browserLang)?browserLang:'en-US';});const[showLanguageSelector,setShowLanguageSelector]=useState(false);const[autoDetectLanguage,setAutoDetectLanguage]=useState(true);const[detectedLanguage,setDetectedLanguage]=useState(null);const[toast,setToast]=useState(null);const[editingMessageId,setEditingMessageId]=useState(null);const[editingText,setEditingText]=useState('');const[uploadedFiles,setUploadedFiles]=useState([]);const[showFileUpload,setShowFileUpload]=useState(false);const[showScrollToBottom,setShowScrollToBottom]=useState(false);const[typingMessageId,setTypingMessageId]=useState(null);const[displayedContent,setDisplayedContent]=useState({});const[openDropdownId,setOpenDropdownId]=useState(null);const[renamingConversationId,setRenamingConversationId]=useState(null);const[renamingText,setRenamingText]=useState('');const[showArchivedModal,setShowArchivedModal]=useState(false);const[conversationFilter,setConversationFilter]=useState('all');const[isGenerating,setIsGenerating]=useState(false);const[generationTimeoutId,setGenerationTimeoutId]=useState(null);const[typingTimeoutIds,setTypingTimeoutIds]=useState([]);// Load conversations on app start\nuseEffect(()=>{const loadConversations=async()=>{try{setConversationsLoading(true);const response=await apiService.getConversations();if(response.success){setPastConversations(response.conversations);}}catch(error){console.error('Failed to load conversations:',error);}finally{setConversationsLoading(false);}};loadConversations();},[]);const chatEndRef=useRef(null);const inputRef=useRef(null);const chatContainerRef=useRef(null);// --- Memoized Values ---\nconst filteredConversations=useMemo(()=>{let filtered=pastConversations.filter(conv=>!conv.is_archived);if(conversationFilter==='favourites'){filtered=filtered.filter(conv=>conv.is_favourite);}if(searchQuery){filtered=filtered.filter(conv=>{var _conv$messages;return conv.title.toLowerCase().includes(searchQuery.toLowerCase())||((_conv$messages=conv.messages)===null||_conv$messages===void 0?void 0:_conv$messages.some(msg=>msg.content.toLowerCase().includes(searchQuery.toLowerCase())));});}return filtered.sort((a,b)=>{if(a.is_favourite&&!b.is_favourite)return-1;if(!a.is_favourite&&b.is_favourite)return 1;return new Date(b.created_at)-new Date(a.created_at);});},[pastConversations,searchQuery,conversationFilter]);const archivedConversations=useMemo(()=>{let archived=pastConversations.filter(conv=>conv.is_archived);if(searchQuery){archived=archived.filter(conv=>{var _conv$messages2;return conv.title.toLowerCase().includes(searchQuery.toLowerCase())||((_conv$messages2=conv.messages)===null||_conv$messages2===void 0?void 0:_conv$messages2.some(msg=>msg.content.toLowerCase().includes(searchQuery.toLowerCase())));});}return archived.sort((a,b)=>new Date(b.created_at)-new Date(a.created_at));},[pastConversations,searchQuery]);const groupConversationsByDate=conversations=>{const now=new Date();const today=new Date(now.getFullYear(),now.getMonth(),now.getDate());const yesterday=new Date(today);yesterday.setDate(yesterday.getDate()-1);const lastWeek=new Date(today);lastWeek.setDate(lastWeek.getDate()-7);const lastMonth=new Date(today);lastMonth.setMonth(lastMonth.getMonth()-1);const groups={today:[],yesterday:[],lastWeek:[],lastMonth:[],older:[]};conversations.forEach(conv=>{const convDate=new Date(conv.created_at);const convDateOnly=new Date(convDate.getFullYear(),convDate.getMonth(),convDate.getDate());if(convDateOnly.getTime()===today.getTime()){groups.today.push(conv);}else if(convDateOnly.getTime()===yesterday.getTime()){groups.yesterday.push(conv);}else if(convDate>=lastWeek){groups.lastWeek.push(conv);}else if(convDate>=lastMonth){groups.lastMonth.push(conv);}else{groups.older.push(conv);}});return groups;};const conversationGroups=useMemo(()=>groupConversationsByDate(filteredConversations),[filteredConversations]);// --- Effects ---\nuseEffect(()=>{var _chatEndRef$current;(_chatEndRef$current=chatEndRef.current)===null||_chatEndRef$current===void 0?void 0:_chatEndRef$current.scrollIntoView({behavior:'smooth'});},[messages]);useEffect(()=>{document.documentElement.setAttribute('data-theme',isDarkMode?'dark':'light');},[isDarkMode]);useEffect(()=>{const handleResize=()=>{const mobile=window.innerWidth<=768;setIsMobile(mobile);if(!mobile&&isSidebarOpen){setIsSidebarOpen(false);}};window.addEventListener('resize',handleResize);return()=>window.removeEventListener('resize',handleResize);},[isSidebarOpen]);useEffect(()=>{const handleClickOutside=event=>{if(isMobile&&isSidebarOpen&&!event.target.closest('.sidebar')&&!event.target.closest('.sidebar-toggle')){setIsSidebarOpen(false);}if(openDropdownId&&!event.target.closest('.conversation-dropdown')&&!event.target.closest('.dropdown-toggle')){setOpenDropdownId(null);}if(showLanguageSelector&&!event.target.closest('.language-selector')&&!event.target.closest('.language-toggle')){setShowLanguageSelector(false);}};document.addEventListener('mousedown',handleClickOutside);document.addEventListener('touchstart',handleClickOutside);return()=>{document.removeEventListener('mousedown',handleClickOutside);document.removeEventListener('touchstart',handleClickOutside);};},[isMobile,isSidebarOpen,openDropdownId,showLanguageSelector]);useEffect(()=>{const chatContainer=chatContainerRef.current;if(!chatContainer)return;const handleScroll=()=>{const{scrollTop,scrollHeight,clientHeight}=chatContainer;const isNearBottom=scrollHeight-scrollTop-clientHeight<100;setShowScrollToBottom(!isNearBottom&&messages.length>0);};chatContainer.addEventListener('scroll',handleScroll);return()=>chatContainer.removeEventListener('scroll',handleScroll);},[messages.length]);// --- Essential Callbacks ---\nconst showToast=useCallback(function(message){let type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'success';setToast({message,type});setTimeout(()=>setToast(null),3000);},[]);// Initialize speech recognition\nuseEffect(()=>{if('webkitSpeechRecognition'in window||'SpeechRecognition'in window){const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;if(autoDetectLanguage){// Create multiple recognition instances for auto-detection\nconst primaryLanguages=['en-US','de-DE','fr-FR','es-ES','it-IT'];const recognitionInstances=[];primaryLanguages.forEach(langCode=>{const recognitionInstance=new SpeechRecognition();recognitionInstance.continuous=false;recognitionInstance.interimResults=true;recognitionInstance.lang=langCode;recognitionInstance.onresult=event=>{let finalTranscript='';let confidence=0;for(let i=event.resultIndex;i<event.results.length;i++){const result=event.results[i];if(result.isFinal){finalTranscript+=result[0].transcript;confidence=result[0].confidence||0;}}if(finalTranscript&&confidence>0.7){// Stop all recognition instances\nrecognitionInstances.forEach(rec=>{try{rec.stop();}catch(e){}});const detectedLang=SUPPORTED_LANGUAGES.find(lang=>lang.code===langCode);setDetectedLanguage(langCode);setSpeechLanguage(langCode);setInput(prev=>prev+finalTranscript);setIsRecording(false);showToast(\"Detected \".concat((detectedLang===null||detectedLang===void 0?void 0:detectedLang.name)||langCode,\": \\\"\").concat(finalTranscript.substring(0,30),\"...\\\"\"),'success');}};recognitionInstance.onerror=event=>{if(event.error!=='aborted'&&event.error!=='no-speech'){console.error(\"Speech recognition error (\".concat(langCode,\"):\"),event.error);}};recognitionInstances.push(recognitionInstance);});setMultiRecognitions(recognitionInstances);}else{// Single language recognition (manual selection)\nconst recognitionInstance=new SpeechRecognition();recognitionInstance.continuous=false;recognitionInstance.interimResults=true;recognitionInstance.lang=speechLanguage;recognitionInstance.onstart=()=>{setIsRecording(true);const selectedLanguage=SUPPORTED_LANGUAGES.find(lang=>lang.code===speechLanguage);showToast(\"Listening in \".concat((selectedLanguage===null||selectedLanguage===void 0?void 0:selectedLanguage.name)||speechLanguage,\"... Speak now\"),'info');};recognitionInstance.onresult=event=>{let finalTranscript='';for(let i=event.resultIndex;i<event.results.length;i++){const transcript=event.results[i][0].transcript;if(event.results[i].isFinal){finalTranscript+=transcript;}}if(finalTranscript){setInput(prev=>prev+finalTranscript);}};recognitionInstance.onend=()=>{setIsRecording(false);};recognitionInstance.onerror=event=>{console.error('Speech recognition error:',event.error);setIsRecording(false);let errorMessage='Speech recognition error';switch(event.error){case'no-speech':errorMessage='No speech detected. Try again.';break;case'not-allowed':errorMessage='Microphone access denied. Please allow microphone access.';break;case'network':errorMessage='Network error. Check your connection.';break;default:errorMessage=\"Speech recognition error: \".concat(event.error);}showToast(errorMessage,'error');};setRecognition(recognitionInstance);}}},[showToast,speechLanguage,autoDetectLanguage]);const typeMessage=useCallback((messageId,content)=>{setTypingMessageId(messageId);setDisplayedContent(prev=>_objectSpread(_objectSpread({},prev),{},{[messageId]:''}));let currentIndex=0;const typingSpeed=8;const timeoutIds=[];const typeChar=()=>{if(currentIndex<content.length){setDisplayedContent(prev=>_objectSpread(_objectSpread({},prev),{},{[messageId]:content.slice(0,currentIndex+1)}));currentIndex++;const timeoutId=setTimeout(typeChar,typingSpeed);timeoutIds.push(timeoutId);setTypingTimeoutIds(prev=>[...prev,timeoutId]);}else{setTypingMessageId(null);setDisplayedContent(prev=>_objectSpread(_objectSpread({},prev),{},{[messageId]:content}));setTypingTimeoutIds(prev=>prev.filter(id=>!timeoutIds.includes(id)));setIsGenerating(false);}};typeChar();},[]);const regenerateResponse=useCallback(async messageId=>{const messageIndex=messages.findIndex(msg=>msg.id===messageId);if(messageIndex===-1||messages[messageIndex].role!=='assistant')return;let userMessageIndex=messageIndex-1;while(userMessageIndex>=0&&messages[userMessageIndex].role!=='user'){userMessageIndex--;}if(userMessageIndex===-1)return;const userMessage=messages[userMessageIndex];const messagesUpToUser=messages.slice(0,messageIndex);setMessages(messagesUpToUser);setDisplayedContent(prev=>{const newContent=_objectSpread({},prev);delete newContent[messageId];return newContent;});setIsLoading(true);setIsGenerating(true);showToast('Regenerating response...');try{// Call backend API to regenerate response\nconst response=await apiService.regenerateResponse(currentConversationId,userMessage.id);if(response.success){const newBotResponseId=Date.now().toString();const botMessage={id:newBotResponseId,role:'assistant',content:response.aiResponse.content,timestamp:response.aiResponse.timestamp,reaction:null,isEdited:false,model:response.aiResponse.model};const finalMessages=[...messagesUpToUser,botMessage];setMessages(finalMessages);setTimeout(()=>{typeMessage(newBotResponseId,response.aiResponse.content);},100);showToast('Response regenerated successfully!');}else{throw new Error(response.error||'Failed to regenerate response');}}catch(error){console.error(\"Failed to regenerate response:\",error);showToast('Failed to regenerate response. Please try again.','error');}finally{setIsLoading(false);setIsGenerating(false);setGenerationTimeoutId(null);setTypingMessageId(null);}},[messages,currentConversationId,typeMessage,showToast]);// --- Helper Functions ---\nconst handleNewChat=()=>{var _inputRef$current;setMessages([]);setCurrentConversationId(null);setInput('');setUploadedFiles([]);(_inputRef$current=inputRef.current)===null||_inputRef$current===void 0?void 0:_inputRef$current.focus();if(isMobile){setIsSidebarOpen(false);}};const handleConversationClick=conversation=>{if(conversation.is_archived){showToast('This conversation is archived. Unarchive it first to view.','error');return;}setCurrentConversationId(conversation.id);setMessages(conversation.messages||[]);if(isMobile){setIsSidebarOpen(false);}};const toggleSidebar=()=>{if(isMobile){setIsSidebarOpen(!isSidebarOpen);if(!isSidebarOpen){setIsSidebarHidden(false);}}else{setIsSidebarHidden(!isSidebarHidden);if(isSidebarHidden){setIsSidebarCollapsed(false);}}};const toggleTheme=()=>{setIsDarkMode(!isDarkMode);};const copyToClipboard=text=>{navigator.clipboard.writeText(text).then(()=>{showToast('Copied to clipboard!');});};const handleFileSelect=files=>{const newFiles=files.map(file=>({id:Date.now()+Math.random(),name:file.name,size:file.size,type:file.type,file:file}));setUploadedFiles(prev=>[...prev,...newFiles]);setShowFileUpload(false);showToast(\"\".concat(files.length,\" file(s) uploaded successfully!\"));};const removeFile=fileId=>{setUploadedFiles(prev=>prev.filter(f=>f.id!==fileId));};const scrollToBottom=()=>{var _chatEndRef$current2;(_chatEndRef$current2=chatEndRef.current)===null||_chatEndRef$current2===void 0?void 0:_chatEndRef$current2.scrollIntoView({behavior:'smooth'});};const handleMessageReaction=(messageId,reaction)=>{setMessages(prev=>prev.map(msg=>msg.id===messageId?_objectSpread(_objectSpread({},msg),{},{reaction:msg.reaction===reaction?null:reaction}):msg));showToast(\"Message \".concat(reaction==='like'?'liked':'disliked',\"!\"));};const handleMessageEdit=messageId=>{const message=messages.find(msg=>msg.id===messageId);if(message){setEditingMessageId(messageId);setEditingText(message.content);}};const saveMessageEdit=()=>{setMessages(prev=>prev.map(msg=>msg.id===editingMessageId?_objectSpread(_objectSpread({},msg),{},{content:editingText,isEdited:true}):msg));setEditingMessageId(null);setEditingText('');showToast('Message updated!');};const toggleConversationFavourite=async(convId,e)=>{e.stopPropagation();try{const conversation=pastConversations.find(c=>c.id===convId);await apiService.updateConversation(convId,{is_favourite:!conversation.is_favourite});// Update local state\nsetPastConversations(prev=>prev.map(conv=>conv.id===convId?_objectSpread(_objectSpread({},conv),{},{is_favourite:!conv.is_favourite}):conv));showToast(conversation!==null&&conversation!==void 0&&conversation.is_favourite?'Removed from favourites!':'Added to favourites!');}catch(error){showToast('Failed to update favourite status','error');}};const archiveConversation=async(convId,e)=>{e.stopPropagation();try{const conversation=pastConversations.find(c=>c.id===convId);await apiService.updateConversation(convId,{is_archived:!conversation.is_archived});// Update local state\nsetPastConversations(prev=>prev.map(conv=>conv.id===convId?_objectSpread(_objectSpread({},conv),{},{is_archived:!conv.is_archived}):conv));if(currentConversationId===convId){handleNewChat();}showToast('Conversation archived!');}catch(error){showToast('Failed to archive conversation','error');}};const deleteConversation=async(convId,e)=>{e.stopPropagation();try{await apiService.deleteConversation(convId);// Update local state\nsetPastConversations(prev=>prev.filter(conv=>conv.id!==convId));if(currentConversationId===convId){handleNewChat();}showToast('Conversation deleted!');}catch(error){showToast('Failed to delete conversation','error');}};const toggleDropdown=(convId,e)=>{e.stopPropagation();setOpenDropdownId(openDropdownId===convId?null:convId);};const closeDropdown=()=>{setOpenDropdownId(null);};const startRenaming=convId=>{const conversation=pastConversations.find(c=>c.id===convId);if(conversation){setRenamingConversationId(convId);setRenamingText(conversation.title);}};const saveRename=async()=>{if(renamingText.trim()){try{await apiService.updateConversation(renamingConversationId,{title:renamingText.trim()});// Update local state\nsetPastConversations(prev=>prev.map(conv=>conv.id===renamingConversationId?_objectSpread(_objectSpread({},conv),{},{title:renamingText.trim()}):conv));showToast('Conversation renamed!');}catch(error){showToast('Failed to rename conversation','error');}}setRenamingConversationId(null);setRenamingText('');};const cancelRename=()=>{setRenamingConversationId(null);setRenamingText('');};const viewArchivedChat=conversation=>{setCurrentConversationId(conversation.id);setMessages(conversation.messages||[]);setShowArchivedModal(false);if(isMobile){setIsSidebarOpen(false);setIsSidebarHidden(true);}};const unarchiveConversation=async convId=>{try{await apiService.updateConversation(convId,{is_archived:false});// Update local state\nsetPastConversations(prev=>prev.map(conv=>conv.id===convId?_objectSpread(_objectSpread({},conv),{},{is_archived:false}):conv));showToast('Conversation unarchived!');}catch(error){showToast('Failed to unarchive conversation','error');}};const deleteArchivedConversation=async convId=>{try{await apiService.deleteConversation(convId);// Update local state\nsetPastConversations(prev=>prev.filter(conv=>conv.id!==convId));showToast('Conversation deleted!');}catch(error){showToast('Failed to delete conversation','error');}};const handleSubmit=async e=>{if(e)e.preventDefault();if(!input.trim()||isLoading||isGenerating)return;const messageText=input.trim();const messageFiles=uploadedFiles.length>0?[...uploadedFiles]:null;// Clear input immediately\nsetInput('');setUploadedFiles([]);setIsLoading(true);setIsGenerating(true);// Add user message to UI immediately\nconst userMessageId=Date.now().toString();const userMessage={id:userMessageId,role:'user',content:messageText,timestamp:new Date().toISOString(),reaction:null,isEdited:false,files:messageFiles};setMessages(prev=>[...prev,userMessage]);try{// Call backend API for real AI response\nconst response=await apiService.sendMessage(messageText,currentConversationId,messageFiles);if(response.success){// Update conversation ID if this was a new conversation\nif(!currentConversationId&&response.conversationId){setCurrentConversationId(response.conversationId);}// Add AI response to UI\nconst botResponseId=Date.now().toString();const botMessage={id:botResponseId,role:'assistant',content:response.aiResponse.content,timestamp:response.aiResponse.timestamp,reaction:null,isEdited:false,model:response.aiResponse.model};setMessages(prev=>[...prev,botMessage]);// Start typing animation\nsetTimeout(()=>{typeMessage(botResponseId,response.aiResponse.content);},100);showToast('Response generated successfully!');}else{throw new Error(response.error||'Failed to get AI response');}}catch(error){console.error(\"Failed to get AI response:\",error);// Add error response\nconst errorResponse={id:Date.now().toString(),role:'assistant',content:\"I apologize, but I'm having trouble connecting to our AI systems right now. Please try again in a moment, or reach out to your HR representative for immediate assistance.\",timestamp:new Date().toISOString(),reaction:null,isEdited:false};setMessages(prev=>[...prev,errorResponse]);showToast('Failed to get AI response. Please try again.','error');}finally{setIsLoading(false);setIsGenerating(false);setGenerationTimeoutId(null);setTypingMessageId(null);typingTimeoutIds.forEach(timeoutId=>clearTimeout(timeoutId));setTypingTimeoutIds([]);}};const handleKeyDown=e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();handleSubmit(e);}};const toggleVoiceMode=()=>{if(autoDetectLanguage){// Auto-detection mode\nif(!multiRecognitions.length){showToast('Speech recognition not supported in this browser','error');return;}if(isRecording){// Stop all recognition instances\nmultiRecognitions.forEach(rec=>{try{rec.stop();}catch(e){}});setIsRecording(false);showToast('Voice recording stopped');}else{try{setIsRecording(true);showToast('Auto-detecting language... Speak now','info');// Start all recognition instances\nmultiRecognitions.forEach(rec=>{try{rec.start();}catch(e){}});// Auto-stop after 10 seconds if no detection\nsetTimeout(()=>{if(isRecording){multiRecognitions.forEach(rec=>{try{rec.stop();}catch(e){}});setIsRecording(false);}},10000);}catch(error){console.error('Error starting speech recognition:',error);showToast('Failed to start voice recording','error');setIsRecording(false);}}}else{// Manual selection mode\nif(!recognition){showToast('Speech recognition not supported in this browser','error');return;}if(isRecording){recognition.stop();showToast('Voice recording stopped');}else{try{recognition.start();}catch(error){console.error('Error starting speech recognition:',error);showToast('Failed to start voice recording','error');}}}};const handleLanguageSelect=useCallback(languageCode=>{setSpeechLanguage(languageCode);setShowLanguageSelector(false);const selectedLanguage=SUPPORTED_LANGUAGES.find(lang=>lang.code===languageCode);showToast(\"Speech language changed to \".concat((selectedLanguage===null||selectedLanguage===void 0?void 0:selectedLanguage.name)||languageCode));},[showToast]);const stopGeneration=()=>{if(generationTimeoutId){clearTimeout(generationTimeoutId);setGenerationTimeoutId(null);}typingTimeoutIds.forEach(timeoutId=>clearTimeout(timeoutId));setTypingTimeoutIds([]);setIsGenerating(false);setIsLoading(false);setTypingMessageId(null);showToast('Generation stopped','error');};const getInputButton=()=>{if(isGenerating||typingMessageId){return{icon:Square,onClick:stopGeneration,className:\"stop-button\",title:\"Stop generation\",disabled:false};}else if(input.trim()){return{icon:ArrowUp,onClick:e=>{e.preventDefault();handleSubmit();},className:\"send-button\",title:\"Send message\",disabled:isLoading||isGenerating||typingMessageId};}else{return{icon:isRecording?MicOff:Mic,onClick:toggleVoiceMode,className:\"voice-btn \".concat(isRecording?'recording':''),title:isRecording?\"Stop recording\":\"Start voice input\",disabled:isLoading||isGenerating||typingMessageId};}};const renderConversationItem=useCallback(conv=>/*#__PURE__*/_jsx(ConversationItem,{conv:conv,isActive:currentConversationId===conv.id,isRenaming:renamingConversationId===conv.id,renamingText:renamingText,setRenamingText:setRenamingText,saveRename:saveRename,cancelRename:cancelRename,onClick:()=>handleConversationClick(conv),openDropdownId:openDropdownId,toggleDropdown:toggleDropdown,closeDropdown:closeDropdown,toggleConversationFavourite:toggleConversationFavourite,archiveConversation:archiveConversation,deleteConversation:deleteConversation,startRenaming:startRenaming},conv.id),[currentConversationId,renamingConversationId,renamingText,openDropdownId]);// If in test mode, show the database test component\n// Test mode removed - now using proper backend API architecture\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"app-container \".concat(isDarkMode?'dark':'light'),children:[showFileUpload&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",onClick:()=>setShowFileUpload(false),children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content file-upload-modal\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Upload Files\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowFileUpload(false),className:\"modal-close\",children:/*#__PURE__*/_jsx(X,{className:\"icon\"})})]}),/*#__PURE__*/_jsx(FileUpload,{onFileSelect:handleFileSelect})]})}),toast&&/*#__PURE__*/_jsx(Toast,{message:toast.message,type:toast.type,onClose:()=>setToast(null)}),/*#__PURE__*/_jsx(ArchivedConversationsModal,{isOpen:showArchivedModal,onClose:()=>setShowArchivedModal(false),conversations:archivedConversations,onViewChat:viewArchivedChat,onUnarchive:unarchiveConversation,onDelete:deleteArchivedConversation}),/*#__PURE__*/_jsxs(\"div\",{className:\"sidebar \".concat(isSidebarCollapsed?'collapsed':'',\" \").concat(isSidebarOpen?'open':'',\" \").concat(isSidebarHidden?'hidden':''),children:[/*#__PURE__*/_jsx(\"div\",{className:\"sidebar-header\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:handleNewChat,className:\"new-chat-btn\",children:[/*#__PURE__*/_jsx(Plus,{className:\"icon\"}),!isSidebarCollapsed&&/*#__PURE__*/_jsx(\"span\",{children:\"New chat\"})]})}),!isSidebarCollapsed&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"search-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"search-wrapper \".concat(isSearchFocused?'focused':''),children:[/*#__PURE__*/_jsx(Search,{className:\"search-icon\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search chats\",value:searchQuery,onChange:e=>setSearchQuery(e.target.value),onFocus:()=>setIsSearchFocused(true),onBlur:()=>setIsSearchFocused(false),className:\"search-input\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"conversation-filters\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"filter-btn \".concat(conversationFilter==='all'?'active':''),onClick:()=>setConversationFilter('all'),children:\"All\"}),/*#__PURE__*/_jsx(\"button\",{className:\"filter-btn \".concat(conversationFilter==='favourites'?'active':''),onClick:()=>setConversationFilter('favourites'),children:\"Favourites\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"conversation-list\",children:conversationsLoading?/*#__PURE__*/_jsx(\"div\",{style:{padding:'20px',textAlign:'center',color:'#666'},children:\"Loading conversations...\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[conversationGroups.today.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"conversation-group\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"group-label\",children:\"Today\"}),conversationGroups.today.map(renderConversationItem)]}),conversationGroups.yesterday.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"conversation-group\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"group-label\",children:\"Yesterday\"}),conversationGroups.yesterday.map(renderConversationItem)]}),conversationGroups.lastWeek.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"conversation-group\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"group-label\",children:\"Previous 7 days\"}),conversationGroups.lastWeek.map(renderConversationItem)]}),conversationGroups.lastMonth.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"conversation-group\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"group-label\",children:\"Previous 30 days\"}),conversationGroups.lastMonth.map(renderConversationItem)]}),conversationGroups.older.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"conversation-group\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"group-label\",children:\"Older\"}),conversationGroups.older.map(renderConversationItem)]}),pastConversations.length===0&&!conversationsLoading&&/*#__PURE__*/_jsxs(\"div\",{style:{padding:'20px',textAlign:'center',color:'#666',fontSize:'14px'},children:[\"No conversations yet.\",/*#__PURE__*/_jsx(\"br\",{}),\"Start a new chat to get started!\"]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"sidebar-footer\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:toggleTheme,className:\"theme-toggle\",children:[isDarkMode?/*#__PURE__*/_jsx(Sun,{className:\"icon\"}):/*#__PURE__*/_jsx(Moon,{className:\"icon\"}),!isSidebarCollapsed&&/*#__PURE__*/_jsx(\"span\",{children:isDarkMode?'Light mode':'Dark mode'})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowArchivedModal(true),className:\"archive-toggle-btn\",children:[/*#__PURE__*/_jsx(Archive,{className:\"icon\"}),!isSidebarCollapsed&&/*#__PURE__*/_jsxs(\"span\",{children:[\"Archived (\",archivedConversations.length,\")\"]})]}),!isSidebarCollapsed&&/*#__PURE__*/_jsx(\"div\",{className:\"user-section\",children:/*#__PURE__*/_jsx(\"div\",{style:{padding:'10px',textAlign:'center',fontSize:'12px',color:'#666',borderTop:'1px solid #eee'},children:\"Single User Mode - No Login Required\"})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"main-content \".concat(isSidebarOpen?'sidebar-open':'',\" \").concat(isSidebarHidden?'sidebar-hidden':''),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-header\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:toggleSidebar,className:\"sidebar-toggle\",children:/*#__PURE__*/_jsx(Sidebar,{className:\"icon\"})}),/*#__PURE__*/_jsx(\"h1\",{className:\"chat-title\",children:currentConversationId?((_pastConversations$fi=pastConversations.find(c=>c.id===currentConversationId))===null||_pastConversations$fi===void 0?void 0:_pastConversations$fi.title)||'Chat':'Onboarding Assistant'})]}),/*#__PURE__*/_jsx(\"div\",{className:\"chat-container\",ref:chatContainerRef,children:messages.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"welcome-screen\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"welcome-icon\",children:/*#__PURE__*/_jsx(Bot,{size:48})}),/*#__PURE__*/_jsx(\"h1\",{className:\"welcome-title\",children:\"How can I help you today?\"}),/*#__PURE__*/_jsx(\"p\",{className:\"welcome-subtitle\",children:\"I'm your onboarding assistant. Ask me anything about company policies, benefits, procedures, or getting started at the company.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"suggestion-cards\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"suggestion-card\",onClick:()=>setInput(\"What are the company's vacation policies?\"),children:/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCC5 Vacation\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"suggestion-card\",onClick:()=>setInput(\"How do I set up my IT equipment?\"),children:/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCBB IT Setup\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"suggestion-card\",onClick:()=>setInput(\"What benefits do I have access to?\"),children:/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDFE5 Benefits\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"suggestion-card\",onClick:()=>setInput(\"Who are my team members?\"),children:/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDC65 Team\"})})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"chat-messages\",children:[messages.map((msg,index)=>/*#__PURE__*/_jsx(Message,{msg:msg,editingMessageId:editingMessageId,editingText:editingText,setEditingText:setEditingText,saveMessageEdit:saveMessageEdit,setEditingMessageId:setEditingMessageId,displayedContent:displayedContent,typingMessageId:typingMessageId,copyToClipboard:copyToClipboard,handleMessageEdit:handleMessageEdit,handleMessageReaction:handleMessageReaction,regenerateResponse:regenerateResponse},msg.id||index)),isLoading&&/*#__PURE__*/_jsxs(\"div\",{className:\"message assistant\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"message-avatar\",children:/*#__PURE__*/_jsx(\"div\",{className:\"avatar assistant-avatar\",children:/*#__PURE__*/_jsx(Bot,{className:\"icon\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"message-content\",children:/*#__PURE__*/_jsx(SkeletonLoader,{})})]}),/*#__PURE__*/_jsx(\"div\",{ref:chatEndRef})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"input-section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"input-container\",children:[showScrollToBottom&&/*#__PURE__*/_jsx(\"button\",{onClick:scrollToBottom,className:\"scroll-to-bottom \".concat(showScrollToBottom?'visible':''),title:\"Scroll to bottom\",children:/*#__PURE__*/_jsx(ArrowUp,{className:\"icon\",style:{transform:'rotate(180deg)'}})}),uploadedFiles.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"uploaded-files\",children:uploadedFiles.map(file=>/*#__PURE__*/_jsxs(\"div\",{className:\"uploaded-file\",children:[/*#__PURE__*/_jsx(FileText,{className:\"icon-sm\"}),/*#__PURE__*/_jsx(\"span\",{children:file.name}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>removeFile(file.id),className:\"remove-file\",children:/*#__PURE__*/_jsx(X,{className:\"icon-sm\"})})]},file.id))}),/*#__PURE__*/_jsx(\"form\",{onSubmit:handleSubmit,children:/*#__PURE__*/_jsxs(\"div\",{className:\"input-wrapper\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"input-actions-left\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setShowFileUpload(true),className:\"file-btn\",title:\"Upload files\",children:/*#__PURE__*/_jsx(Paperclip,{className:\"icon\"})})}),/*#__PURE__*/_jsx(\"textarea\",{ref:inputRef,value:input,onChange:e=>setInput(e.target.value),onKeyDown:handleKeyDown,placeholder:isGenerating||typingMessageId?\"Generating response...\":\"Message ChatGPT...\",className:\"message-input\",rows:1,disabled:isGenerating||typingMessageId}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-actions-right\",children:[!input.trim()&&/*#__PURE__*/_jsxs(\"div\",{className:\"language-selector-container\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setShowLanguageSelector(!showLanguageSelector),className:\"language-toggle\",title:autoDetectLanguage?\"Auto-detecting language\":\"Select speech language\",children:autoDetectLanguage?'ðŸŒ':((_SUPPORTED_LANGUAGES$=SUPPORTED_LANGUAGES.find(lang=>lang.code===speechLanguage))===null||_SUPPORTED_LANGUAGES$===void 0?void 0:_SUPPORTED_LANGUAGES$.flag)||'ðŸŒ'}),showLanguageSelector&&/*#__PURE__*/_jsxs(\"div\",{className:\"language-selector\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"language-mode-toggle\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setAutoDetectLanguage(!autoDetectLanguage),className:\"mode-toggle-btn \".concat(autoDetectLanguage?'active':''),children:\"\\uD83E\\uDD16 Auto-detect\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setAutoDetectLanguage(false),className:\"mode-toggle-btn \".concat(!autoDetectLanguage?'active':''),children:\"\\uD83C\\uDFAF Manual\"})]}),detectedLanguage&&autoDetectLanguage&&/*#__PURE__*/_jsxs(\"div\",{className:\"detected-language\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"detected-label\",children:\"Last detected:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"detected-flag\",children:(_SUPPORTED_LANGUAGES$2=SUPPORTED_LANGUAGES.find(lang=>lang.code===detectedLanguage))===null||_SUPPORTED_LANGUAGES$2===void 0?void 0:_SUPPORTED_LANGUAGES$2.flag}),/*#__PURE__*/_jsx(\"span\",{className:\"detected-name\",children:(_SUPPORTED_LANGUAGES$3=SUPPORTED_LANGUAGES.find(lang=>lang.code===detectedLanguage))===null||_SUPPORTED_LANGUAGES$3===void 0?void 0:_SUPPORTED_LANGUAGES$3.name})]}),!autoDetectLanguage&&/*#__PURE__*/_jsx(_Fragment,{children:SUPPORTED_LANGUAGES.map(language=>/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleLanguageSelect(language.code),className:\"language-option \".concat(speechLanguage===language.code?'active':''),title:language.name,children:[/*#__PURE__*/_jsx(\"span\",{className:\"language-flag\",children:language.flag}),/*#__PURE__*/_jsx(\"span\",{className:\"language-name\",children:language.name})]},language.code))})]})]}),(()=>{const buttonConfig=getInputButton();const IconComponent=buttonConfig.icon;return/*#__PURE__*/_jsx(\"button\",{type:buttonConfig.className===\"send-button\"?\"submit\":\"button\",onClick:buttonConfig.className===\"send-button\"?undefined:buttonConfig.onClick,disabled:buttonConfig.disabled,className:buttonConfig.className,title:buttonConfig.title,children:/*#__PURE__*/_jsx(IconComponent,{className:\"icon\"})});})()]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"input-footer\",children:/*#__PURE__*/_jsx(\"span\",{children:\"ChatGPT can make mistakes. Check important info.\"})})]})})]})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}